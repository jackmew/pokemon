{
  "name": "mongoose-simpledb",
  "version": "2.1.1",
  "description": "Simple API for defining mongoose dbmodels and loading them into a single object for easy access.",
  "main": "index.js",
  "dependencies": {
    "extend": "*",
    "mongoose": "*",
    "mongoose-auto-increment": "*",
    "async": "~0.2.9"
  },
  "devDependencies": {
    "mocha": "*",
    "chai": "*",
    "moment": "*",
    "marked": "*",
    "async": "*"
  },
  "scripts": {
    "test": "mocha"
  },
  "repository": {
    "type": "git",
    "url": "git://github.com/codetunnel/mongoose-simpledb.git"
  },
  "keywords": [
    "mongoose"
  ],
  "author": {
    "name": "Alex Ford"
  },
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/codetunnel/mongoose-simpledb/issues"
  },
  "readme": "# mongoose-simpledb\n\n[![Build Status](https://travis-ci.org/codetunnel/mongoose-simpledb.png)](https://travis-ci.org/codetunnel/mongoose-simpledb)\n[![Dependencies Status](https://gemnasium.com/codetunnel/mongoose-simpledb.png)](https://gemnasium.com/codetunnel/mongoose-simpledb)\n[![NPM version](https://badge.fury.io/js/mongoose-simpledb.png)](http://badge.fury.io/js/mongoose-simpledb)\n\n> Simple API for defining mongoose models and loading them into a single object for easy access.\n\n## Getting Started\n\n> npm install mongoose-simpledb\n\nNote: You do not need to install mongoose. Simpledb is intended to hide mongoose so you never have to install or require it.\n\nAfter installing simpledb you'll want to define your mongoose models. By default simpledb looks in the root of your project for a directory called \"dbmodels\" and will load all model files found there. However, you can place your models wherever you wish and pass the location in simpledb's options. Let's look at an example model file.\n\n```javascript\n// dbmodels/Comment.js\n\nvar ObjectId = require('mongoose-simpledb').Types.ObjectId;\n\nexports.schema = {\n    creator: { type: ObjectId, ref: 'User' },\n    blogPost: { type: Number, ref: 'BlogPost' },\n    url: String,\n    body: String,\n    date: { type: Date, default: Date.now },\n    editedDate: Date,\n    editedBy: { type: ObjectId, ref: 'User' }\n};\n```\n    \nOnce you have a model file you can get reference to simpledb and call its `init` function. You can pass a callback function to `init` that will receive the `db` object when all of your models have finished being loaded into it. Or you can assign the results of the `init` function to a variable which will be lazy-loaded with your models when they are done being loaded;\n\nCallback:\n\n```javascript\nvar simpledb = require('mongoose-simpledb');\nsimpledb.init(function (err, db) {\n    if (err) return console.error(err);\n    // You can safely assume that db is populated with your models.\n    db.Comment.find({ blogPost: 123 }, ...):\n});\n```\n\nLazy-loaded reference:\n\n```javascript\nvar simpledb = require('mongoose-simpledb');\nvar db = simpledb.init();\n// After a time...\ndb.Comment.find({ blogPost: 123 }, ...);\n```\n\nIf you prefer to use the lazy-loaded option then you can check `db.modelsLoaded` to see if the object is ready to be used. The only requirement of a model file is that you expose a property called `schema`. simpledb will use this property when creating your Mongoose schema. While `schema` is the only required property for you to define, you can define a few others as well if you'd like to setup instance methods, static methods, or virtual properties.\n\n## Need instance methods?\n\n```javascript\nexports.methods = {\n    dateFromNow: function () {\n        return moment(this.date).fromNow();\n    },\n    editedDateFromNow: function () {\n        return moment(this.editedDate).fromNow();\n    }\n};\n```\n\n## What about statics?\n\n```javascript\nexports.statics = {\n    tenMostRecent: function (blogPostId, callback) {\n        return this.where('date').sort('-date').limit(10).exec(callback);\n    }\n};\n```\n\n## Yes, you can even define virtual properties.\n\n```javascript\nexports.virtuals = {\n    bodyHtml: {\n        get: function () {\n            return marked(this.body);\n        }\n    },\n    website: {\n        get: function () {\n            return this.url;\n        },\n        set: function (url) {\n            if (!/^http:\\/\\//i.test(url))\n                url = \"http://\" + url;\n            this.url = url;\n        }\n    }\n};\n```\n\nYou can see that when specifying virtuals you can include both \"get\" and/or \"set\" as needed for that virtual property. You can also use dot notation with your instance methods in virtuals. Just replace the method/virtual name with a string and use dots.\n\n```javascript\n// dbmodels/Person.js\n\nexports.schema = {\n    name: {\n        first: String,\n        last: String\n    }\n};\n\nexports.virtuals = {\n    \"name.full\": {\n        get: function () {\n            return this.name.first + ' ' + this.name.last;\n        },\n        set: function (fullName) {\n            if (fullName.indexOf(' ') !== -1) {\n                var segments = fullName.split(' ');\n                this.name.first = segments[0];\n                this.name.last = segments[1];\n            } else {\n                this.name.first = fullName;\n            }\n        }\n    }\n};\n```\n\n## Options\n\nAn options object can be passed to the `init` function.\n```javascript\nsimpledb.init(options, callback);\n```\n\nAvailable Options and their default values:\n\n```javascript\n{\n    // The mongoose connection string to use.\n    connectionString: 'mongodb:\\\\localhost',\n    // The path to the directory where your models are stored.\n    modelsDir: path.join(__dirname, '..', '..', 'dbmodels'),\n    // Whether or not simpledb should auto-increment _id's of type Number.\n    autoIncrementNumberIds: true\n}\n```\n\nAny of these can be overridden as needed.\n\n---\n\n## Need a reference to `ObjectId` or other mongoose types?\n\nOne goal of simpledb is to hide mongoose so that you never have to install it or `require` it yourself. One problem with this is that sometimes you need access to mongoose's types. For this reason simpledb exposes `mongoose.Schema.Types` as `simpledb.Types`.\n```javascript\nvar ObjectId = require('mongoose-simpledb').Types.ObjectId;\n```\n\nThen you can use it in your schemas.\n\n```javascript\nexports.schema = {\n    creator: { type: ObjectId, ref: 'User' }\n};\n```\n\n---\n\n## Want to get rid of `ObjectId` altogether and use a simple incrementing `Number` `_id`?\n\nOe feature that Mongoose/MongoDB lack out of the box is the ability to automatically increment a simple integer ID with each new document added to the database. I wrote a mongoose plugin called [mongoose-auto-increment](http://github.com/Chevex/mongoose-auto-increment) that enables this functionality. If you explicitly declare the `_id` field on your schema as type `Number` then simpledb will automatically invoke the mongoose-auto-increment plugin for that model.\n\n```javascript\nexports.schema = {\n    _id: Number, // Causes simpledb to auto-increment _id for new documents.\n    creator: { type: Number, ref: 'User' }\n};\n```\n\n---\n\n## Tired of passing the `db` around to other areas of your application?\n\nIn node, modules are cached after they are first grabbed with `require`. Simpledb utilizes this fact to make it extremely easy for you to access your `db` object from anywhere by simply calling `require` again. As long as you've called `init` and enough time has passed for your `db` object's models to be loaded then you can access it.\n\n```javascript\nvar simpledb = require('mongoose-simpledb');\n\nsimpledb.init(connectionString);\n\n// After a time...\n\nvar db = require('mongoose-simpledb').db;\n```\n\nRemember that you can always check `db.modelsLoaded` to ensure that the object is ready to use.\n\n---\n\n## Mongoose-simpledb in 30-ish seconds!\n\nIn this screencast graphic you can watch as I wrap a basic [express](http://expressjs.com) app with simpledb. I first wrap the code in app.js inside the `simpledb.init` callback to ensure that `db` is ready to use by the time the server spins up. Next I create a model file at `dbmodels/Person.js` and populate the schema with some basic properties, define a virtual property, and create an example method. Finally, I write a couple quick route handlers that are invoked by a form page so that I can create a `Person` as well as retrieve it.\n\n[![](http://i.imgur.com/p16GDGP.gif)](http://i.imgur.com/p16GDGP.gif)\n",
  "readmeFilename": "README.md",
  "homepage": "https://github.com/codetunnel/mongoose-simpledb",
  "_id": "mongoose-simpledb@2.1.1",
  "_from": "mongoose-simpledb@"
}
